<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Калькулятор — Potolok.kh</title>
  <link rel="stylesheet" href="styles.css">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-61EMVPPMDT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-61EMVPPMDT');
  </script>

  <style>
    /* Лёгкая стилизация страницы + кнопок калькулятора */
    .nav-inline{padding:8px 12px}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .card{background:#0f172a;color:#e5e7eb;border:1px solid #1f2a44;border-radius:12px}
    .card .pad{padding:16px}
    .input{width:100%;padding:10px 12px;border:1px solid #1f2a44;border-radius:8px;background:#0b1220;color:#e5e7eb}
    label{display:block;margin:6px 0 6px;font-weight:600}
    .btn{background:#16a34a;color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn:hover{filter:brightness(1.06)}
    .small{font-size:14px;opacity:.9}
    .badge{display:inline-block;background:#22c55e;color:#052e12;padding:4px 10px;border-radius:999px;margin-left:6px}
    footer.footer{padding:16px 0;text-align:center;opacity:.85}
    /* FAB на мобилке */
    @media (max-width: 768px){
      .callback-fab{
        position: fixed; right: 14px; bottom: 18px; z-index: 10000;
        background:#16a34a;color:#fff;border:0;border-radius:999px;
        padding:14px 18px;font-weight:700;text-decoration:none;
        box-shadow:0 8px 24px rgba(0,0,0,.25);
      }
      .callback-fab:hover{background:#15803d}
    }

    /* Модалка «Заявка на дзвінок» */
    .callback-modal{position:fixed;inset:0;background:rgba(0,0,0,.5);
      display:flex;align-items:center;justify-content:center;z-index:9999}
    .callback-card{background:#fff;color:#111;padding:25px 20px;border-radius:12px;
      box-shadow:0 8px 30px rgba(0,0,0,.2);width:min(420px,92vw);position:relative}
    .close-btn{position:absolute;top:10px;right:14px;font-size:22px;border:none;background:transparent;cursor:pointer}
    #callbackForm label{display:block;margin:10px 0 4px;font-weight:600}
    #callbackForm input{width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px}
    #callbackForm .submit-btn{margin-top:14px;width:100%;padding:12px;border:0;border-radius:8px;
      font-size:16px;background:#16a34a;color:#fff;cursor:pointer;font-weight:600}
    #callbackForm .submit-btn:hover{background:#15803d}
    .status{min-height:20px;margin-top:10px;font-size:14px}
    .status.ok{color:#16a34a}.status.err{color:#dc2626}
  </style>
</head>
<body>

  <nav class="nav">
    <div class="row container" style="align-items:center;justify-content:space-between">
      <div class="brand">Potolok.kh</div>
      <div class="links">
        <a href="index.html">Головна</a>
        <a href="gallery.html">Галерея</a>
        <a href="price.html">Прайс</a>
        <a href="calculator.html" class="active">Калькулятор</a>
        <a href="reviews.html">Відгуки</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <h1>Калькулятор вартості</h1>

    <div class="card"><div class="pad">
      <div class="row">
        <div style="flex:1 1 180px">
          <label for="area">Площа (м²)</label>
          <input id="area" type="number" class="input" value="15" min="1" step="0.1">
        </div>
        <div style="flex:1 1 180px">
          <label for="perimeter">Периметр (м.п.)</label>
          <input id="perimeter" type="number" class="input" value="16" min="1" step="0.1">
        </div>
        <div style="flex:1 1 160px">
<label for="corners">Кути (шт)</label>
          <input id="corners" type="number" class="input" value="4" min="0" step="1">
        </div>
        <div style="flex:1 1 200px">
          <label for="spots">Точкові світильники (шт)</label>
          <input id="spots" type="number" class="input" value="8" min="0" step="1">
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div style="flex:1 1 180px">
          <label for="chandQty">Люстри (шт)</label>
          <input id="chandQty" type="number" class="input" value="1" min="0" step="1">
        </div>
        <div style="flex:1 1 220px">
          <label for="len_cornice">Карниз вбудований (м.п.)</label>
          <input id="len_cornice" class="input" type="number" value="0" min="0" step="0.1">
        </div>
      </div>

      <h3 style="margin-top:14px">Тарифи</h3>
      <div class="row">
        <div style="flex:1 1 200px"><label for="p_base">Стеля базова (грн/м²)</label><input id="p_base" class="input" type="number" value="400"></div>
        <div style="flex:1 1 200px"><label for="p_floating">Паряща лінія (грн/м.п.)</label><input id="p_floating" class="input" type="number" value="550"></div>
        <div style="flex:1 1 200px"><label for="p_track">Трек-системи (грн/м.п.)</label><input id="p_track" class="input" type="number" value="200"></div>
        <div style="flex:1 1 200px"><label for="p_spot">Світильник (грн/шт)</label><input id="p_spot" class="input" type="number" value="150"></div>
        <div style="flex:1 1 200px"><label for="p_corner">Кут (грн/шт)</label><input id="p_corner" class="input" type="number" value="50"></div>
      </div>

      <div class="row" style="margin-top:12px">
        <div style="flex:1 1 200px"><label for="p_chandelier">Люстра (грн/шт)</label><input id="p_chandelier" class="input" type="number" value="400"></div>
        <div style="flex:1 1 220px"><label for="p_cornice">Карниз вбудований (грн/м.п.)</label><input id="p_cornice" class="input" type="number" value="1000"></div>
      </div>

      <div class="row" style="margin-top:12px">
        <div style="flex:1 1 200px"><label for="len_floating">Довжина парячої лінії (м.п.)</label><input id="len_floating" class="input" type="number" value="0" min="0" step="0.1"></div>
        <div style="flex:1 1 200px"><label for="len_track">Довжина треку (м.п.)</label><input id="len_track" class="input" type="number" value="0" min="0" step="0.1"></div>
      </div>

      <p style="margin-top:14px">
        <button class="btn" onclick="calc()">Порахувати</button>
        <a id="openCallback" class="btn" style="background:#0ea5e9">Залишити заявку</a>
      </p>

      <div id="result" class="small"></div>
    </div></div>
  </main>

  <footer class="footer">© 2025 Potolok.kh • Харків • Монтаж натяжних стель</footer>

  <!-- Модалка -->
  <div id="callbackModal" class="callback-modal" style="display:none;">
    <div class="callback-card">
      <button id="closeCallback" class="close-btn" aria-label="Закрити">×</button>
      <h3>Заявка на дзвінок</h3>
      <form id="callbackForm" novalidate>
        <label for="cbName">Ваше ім'я (необов'язково)</label>
        <input type="text" id="cbName" name="name" placeholder="Іван">
        <label for="cbPhone">Номер телефону</label>
        <input type="tel" id="cbPhone" name="phone" placeholder="+380XXXXXXXXX" required>
        <input type="text" name="company" id="cbCompany" style="display:none" tabindex="-1" autocomplete="off">
        <button type="submit" class="submit-btn">Відправити</button>
        <p id="cbStatus" class="status"></p>
      </form>
    </div>
  </div>

  <!-- Плавающая кнопка на мобилке -->
  <a id="openCallbackFab" href="#" class="callback-fab">Залишити заявку</a>

  <script>
    // ===== Калькулятор =====
function fmt(n){return new Intl.NumberFormat('uk-UA').format(Math.round(n));}
    function val(id){return parseFloat(document.getElementById(id).value)||0;}
    function calc(){
      const area       = val('area');
      const corners    = val('corners');
      const spots      = val('spots');
      const chandQty   = val('chandQty');
      const lenCornice = val('len_cornice');
      const lenFloat   = val('len_floating');
      const lenTrack   = val('len_track');

      const p_base       = val('p_base');
      const p_float      = val('p_floating');
      const p_track      = val('p_track');
      const p_spot       = val('p_spot');
      const p_corner     = val('p_corner');
      const p_chandelier = val('p_chandelier');
      const p_cornice    = val('p_cornice');

      const base   = area * p_base;
      const floating = lenFloat * p_float;
      const track    = lenTrack * p_track;
      const spot     = spots * p_spot;
      const corner   = corners * p_corner;
      const chandelier = chandQty * p_chandelier;
      const cornice    = lenCornice * p_cornice;

      const total = base + floating + track + spot + corner + chandelier + cornice;

      const html = 
        <div class="card" style="margin-top:10px"><div class="pad">
          <strong>Орієнтовна вартість:</strong>
          <span class="badge">${fmt(total)} грн</span><br>
          <span class="small">
            База: ${fmt(base)} • Паряща: ${fmt(floating)} • Трек: ${fmt(track)} •
            Світильники: ${fmt(spot)} • Кути: ${fmt(corner)} • Люстри: ${fmt(chandelier)} •
            Карниз: ${fmt(cornice)}
          </span>
        </div></div>;
      document.getElementById('result').innerHTML = html;
    }
    calc();

    // ===== Модалка «Заявка на дзвінок» =====
    (function(){
      const openBtn  = document.getElementById('openCallback');
      const fab      = document.getElementById('openCallbackFab');
      const modal    = document.getElementById('callbackModal');
      const closeBtn = document.getElementById('closeCallback');
      const form     = document.getElementById('callbackForm');
      const phone    = document.getElementById('cbPhone');
      const status   = document.getElementById('cbStatus');
      const honeypot = document.getElementById('cbCompany');

      function open(){ modal.style.display='flex'; }
      function close(){ modal.style.display='none'; status.textContent=''; status.className='status'; }

      if(openBtn) openBtn.addEventListener('click', (e)=>{e.preventDefault(); open();});
      if(fab)     fab.addEventListener('click', (e)=>{e.preventDefault(); open();});
      if(closeBtn) closeBtn.addEventListener('click', close);
      if(modal) modal.addEventListener('click', (e)=>{ if(e.target===modal) close(); });

      if(phone){
        phone.addEventListener('input', ()=>{
          let v = phone.value.replace(/[^\d+]/g,'');
          if(!v.startsWith('+')) v = '+38' + v.replace(/^\+/,'');
          phone.value = v;
        });
      }

      if(form){
        form.addEventListener('submit', async (e)=>{
          e.preventDefault(); status.textContent=''; status.className='status';
          if(honeypot.value){ return; } // спам-бот
          const name = (document.getElementById('cbName')?.value || '').trim();
          const ph   = phone.value.trim();
          if(!/^\+?38\d{10}$/.test(ph.replace(/\s/g,''))){
            status.textContent='Перевірте номер телефону у форматі +380XXXXXXXXX';
            status.classList.add('err'); return;
          }
          try{
            const res  = await fetch('/api/telegram-submit', {
              method:'POST', headers:{'Content-Type':'application/json'},
              body: JSON.stringify({ name, phone: ph })
            });
            const data = await res.json().catch(()=>({}));
if(res.ok && (data.ok || data.result)){
              status.textContent='Дякуємо! Ми передзвонимо найближчим часом.';
              status.classList.add('ok'); form.reset();
              setTimeout(close, 1200);
            }else{
              status.textContent='Помилка відправки. Спробуйте ще раз або напишіть нам.';
              status.classList.add('err');
            }
          }catch{
            status.textContent='Сталася помилка. Спробуйте ще раз або напишіть нам.';
            status.classList.add('err');
          }
        });
      }
    })();
  </script>
</body>
</html>
