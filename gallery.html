// ----- состояние -----
    let idx = 0;
    let timer = null;
    const INTERVAL = 2000; // автопрокрутка 2 сек

    // точки
    const dots = images.map((_,i)=>{
      const d = document.createElement('span');
      d.className = 'dot'; d.title = ${i+1}/${images.length};
      d.addEventListener('click', ()=>go(i));
      dotsWrap.appendChild(d);
      return d;
    });

    function show(i){
      idx = (i + images.length) % images.length;
      const src = images[idx];
      view.src = src;
      caption.textContent = ${idx+1} / ${images.length};
      dots.forEach((d,j)=>d.classList.toggle('active', j===idx));
      // предзагрузка следующего
      const next = new Image();
      next.src = images[(idx+1)%images.length];
    }
    function next(){ show(idx+1); }
    function prev(){ show(idx-1); }

    function play(){
      pauseBtn.textContent = '⏸';
      clearInterval(timer);
      timer = setInterval(next, INTERVAL);
    }
    function pause(){
      pauseBtn.textContent = '▶';
      clearInterval(timer);
      timer = null;
    }
    pauseBtn.addEventListener('click', ()=> timer ? pause() : play());
    nextBtn.addEventListener('click', ()=>{ pause(); next(); });
    prevBtn.addEventListener('click', ()=>{ pause(); prev(); });

    // свайп
    let sx = 0;
    frame.addEventListener('touchstart', e=>{ sx = e.touches[0].clientX; }, {passive:true});
    frame.addEventListener('touchend', e=>{
      const dx = e.changedTouches[0].clientX - sx;
      if(Math.abs(dx) > 40){ pause(); (dx<0?next:prev)(); }
    }, {passive:true});

    // клавиатура
    window.addEventListener('keydown', e=>{
      if(e.key === 'ArrowRight'){ pause(); next(); }
      if(e.key === 'ArrowLeft'){ pause(); prev(); }
      if(e.key === ' '){ e.preventDefault(); (timer?pause:play)(); }
      if(e.key === 'f'){ toggleFull(); }
      if(e.key === 'Escape'){ if(document.fullscreenElement) document.exitFullscreen(); }
    });

    function toggleFull(){
      const el = document.documentElement;
      if(!document.fullscreenElement){ (el.requestFullscreenel.webkitRequestFullscreenel.msRequestFullscreen).call(el); }
      else { (document.exitFullscreendocument.webkitExitFullscreendocument.msExitFullscreen).call(document); }
    }
    fullBtn.addEventListener('click', toggleFull);

    // старт
    show(0); play();
  </script>
</body>
</html>
